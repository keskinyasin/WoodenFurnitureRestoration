@page "/logout"
@rendermode InteractiveServer
@using WoodenFurnitureRestoration.Blazor.Services
@inject AuthService AuthService
@inject AdminSessionService SessionService
@inject NavigationManager Navigation
@inject ILogger<Logout> Logger

<div class="text-center mt-5">
    <div class="spinner-border" role="status">
        <span class="visually-hidden">Çıkış yapılıyor...</span>
    </div>
    <p class="mt-3">🚪 Çıkış yapılıyor...</p>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                Logger.LogInformation("🚪 Logout başladı...");

                // ✅ Client-side logout
                await AuthService.LogoutAsync();

                Logger.LogInformation("✅ SessionStorage temizlendi");

                await Task.Delay(1000);

                Logger.LogInformation("➡️ / sayfasına yönlendiriliyor");
                Navigation.NavigateTo("/", forceLoad: true);
            }
            catch (Exception ex)
            {
                Logger.LogError(ex, "❌ Logout hatası");
                Navigation.NavigateTo("/", forceLoad: true);
            }
        }
    }
}